{% extends "basic_page.html" %}
{% block body %}
<div class="chain-form">
    <div class="form-header">
        <h2 class="section-title">Add Chain</h2>
        <p class="section-description">
            Chains contain firewall rules and define how traffic is processed. 
            Configure the chain properties and default policy.
            <a href="https://docs.vyos.io/en/sagitta/configuration/firewall/general.html" target="_blank" class="docs_link">
                Documentation â†—
            </a>
        </p>
    </div>
    
    {% with flashed_messages = get_flashed_messages(with_categories=true) %}
    {% if flashed_messages %}
    <div class="flash-messages">
        {% for category, flash_message in flashed_messages %}
        <div class="alert alert-{{ category }}">
            {{flash_message}}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
    
    <form action="/chain_add" method="post" class="form">
        <input type="hidden" name="type" value="add">
        
        <div class="form-grid">
            <div class="form-section">
                <h3 class="subsection-title">Basic Configuration</h3>
                
                <div class="form-group">
                    <label for="fw_chain" class="form-label">Chain Name</label>
                    <input type="text" name="fw_chain" id="fw_chain" class="form-input" 
                           value="{{ chain_detail.chain_name if chain_detail and chain_detail.chain_name else '' }}" 
                           placeholder="Enter chain name" required>
                </div>
                
                <div class="form-group">
                    <label for="description" class="form-label">Description (Optional)</label>
                    <input type="text" name="description" id="description" class="form-input" 
                           value="{{ chain_detail.description if chain_detail and chain_detail.description else '' }}" 
                           placeholder="Brief description of the chain">
                </div>
                
                <div class="form-group">
                    <label class="form-label">IP Version</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="ip_version" value="ipv4" 
                                   {% if not chain_detail or not chain_detail.ip_version or chain_detail.ip_version == 'ipv4' %}checked{% endif %}>
                            <span>IPv4</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="ip_version" value="ipv6" 
                                   {% if chain_detail and chain_detail.ip_version == 'ipv6' %}checked{% endif %}>
                            <span>IPv6</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3 class="subsection-title">Chain Policy</h3>
                
                <div class="form-group">
                    <label class="form-label">Default Action</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="default_action" value="accept" 
                                   {% if not chain_detail or not chain_detail.default_action or chain_detail.default_action == 'accept' %}checked{% endif %}>
                            <span>Accept</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="default_action" value="drop" 
                                   {% if chain_detail and chain_detail.default_action == 'drop' %}checked{% endif %}>
                            <span>Drop</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="default_action" value="reject" 
                                   {% if chain_detail and chain_detail.default_action == 'reject' %}checked{% endif %}>
                            <span>Reject</span>
                        </label>
                    </div>
                    <small class="form-help">Default action for packets that don't match any rules</small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Chain Type</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="chain_type" value="input" 
                                   {% if not chain_detail or not chain_detail.chain_type or chain_detail.chain_type == 'input' %}checked{% endif %}>
                            <span>Input</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="chain_type" value="output" 
                                   {% if chain_detail and chain_detail.chain_type == 'output' %}checked{% endif %}>
                            <span>Output</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="chain_type" value="forward" 
                                   {% if chain_detail and chain_detail.chain_type == 'forward' %}checked{% endif %}>
                            <span>Forward</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Enable Logging</label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="enable_logging" value="true" 
                               {% if chain_detail and chain_detail.enable_logging %}checked{% endif %}>
                        <span class="checkbox-label">Log dropped packets</span>
                    </label>
                    <small class="form-help">Enable logging for packets that are dropped by this chain</small>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Add Chain</button>
            <a href="{{ url_for('chain_view') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
.chain-form {
    max-width: 1000px;
}

.radio-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.radio-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
}

.radio-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--primary-color);
}

.radio-item input[type="radio"]:checked + span {
    color: var(--primary-color);
    font-weight: 600;
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
    width: fit-content;
}

.checkbox-item:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: var(--primary-color);
}

.checkbox-item input[type="checkbox"]:checked + .checkbox-label {
    color: var(--primary-color);
    font-weight: 600;
}
</style>
{% endblock body %}
