<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FW-GUI - Firewall Management</title>
        <link rel="stylesheet" href="static/styles.css" type="text/css" />
        <link
            rel="shortcut icon"
            href="{{ url_for('static', filename='favicon.ico') }}"
        />
        <script type="text/javascript" src="static/jquery.min.js"></script>
    </head>

    <header class="header">
        <div class="header-content">
            <div class="header-logo">
                <img src="static/fw-gui.png" alt="FW-GUI Logo" />
            </div>
            <div class="header-title">
                <h1>Firewall GUI</h1>
                <p class="subtitle">for use with VyOS</p>
            </div>
            <div class="header-spacer"></div>
        </div>
    </header>

    <body class="page_background">
        <div class="main-container">
            {% if current_user.is_authenticated %}
            <div class="user-bar">
                <div class="user-info">
                    <span class="username">{{ username }}</span>
                    {% if firewall_name %}
                    <span class="firewall-name">{{ firewall_name }}</span>
                    {% endif %}
                </div>
                <div class="user-actions">
                    <a
                        href="{{ url_for('admin_settings')}}"
                        class="btn btn-secondary"
                        title="View administrative settings"
                        >Admin Settings</a
                    >
                    <a
                        href="{{ url_for('user_change_password')}}"
                        class="btn btn-secondary"
                        title="Change password"
                        >Change Password</a
                    >
                    <a
                        href="{{ url_for('user_logout')}}"
                        class="btn btn-secondary"
                        title="Logout"
                        >Logout</a
                    >
                </div>
            </div>

            <!-- {% with flashed_messages = get_flashed_messages(with_categories=true) %}
        {% if flashed_messages %}
        <div class="flash-messages">
            {% for category, flash_message in flashed_messages %}
            <div class="alert alert-{{ category }}">{{flash_message}}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %} -->
            {% endif %}

            <div class="content-grid">
                <aside class="sidebar-left">
                    {% if current_user.is_authenticated %}
                    <div class="sidebar-section">
                        <h2 class="section-title">Firewall Configurations</h2>

                        {% if file_list %}
                        <form
                            action="/select_firewall_config"
                            method="post"
                            class="config-form"
                        >
                            {% for file in file_list %}
                            <button
                                type="submit"
                                name="file"
                                value="{{file}}"
                                class="btn btn-config"
                                title="Load firewall configuration {{file}}"
                            >
                                {{file}}
                            </button>

                            {% if file == firewall_name %}
                            <div class="snapshots-section">
                                <h3 class="subsection-title">Snapshots</h3>
                                <button
                                    type="submit"
                                    name="file"
                                    value="{{file}}/create"
                                    class="btn btn-add"
                                    title="Create a new snapshot"
                                >
                                    Create
                                </button>
                                <p class="snapshot-info">
                                    Clicking a snapshot will load it and
                                    overwrite your current "working copy"
                                    config. Create a snapshot first if you have
                                    unsaved changes.
                                </p>

                                {% if snapshot_list %}
                                <div class="snapshot-list">
                                    {% for snapshot in snapshot_list %}
                                    <div class="snapshot-item">
                                        <button
                                            type="submit"
                                            name="file"
                                            value="{{snapshot.id}}/delete/{{snapshot.name}}"
                                            class="btn btn-delete-small"
                                            title="Delete snapshot {{snapshot.name}}"
                                        >
                                            ×
                                        </button>
                                        <button
                                            type="submit"
                                            name="file"
                                            value="{{snapshot.id}}/{{snapshot.name}}"
                                            class="btn btn-snapshot"
                                            title="Load snapshot {{snapshot.name}}"
                                        >
                                            {{snapshot.name}}
                                        </button>
                                        <div class="tooltip">
                                            <a
                                                href="{{url_for('snapshot_tag_create')}}"
                                            >
                                                <img
                                                    src="static/tag-yellow.svg"
                                                    width="16"
                                                    height="16"
                                                    alt="Tag"
                                                />
                                            </a>
                                            <span class="tooltiptext"
                                                >Tag: {{snapshot.tag}}</span
                                            >
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                                <a
                                    href="{{url_for('snapshot_diff_choose')}}"
                                    class="btn btn-secondary full-width"
                                    >View Snapshot Diff</a
                                >
                                {% endif %}
                            </div>
                            {% endif %} {% endfor %}
                        </form>
                        {% endif %}

                        <div class="config-actions">
                            <h3 class="subsection-title">
                                Create Configuration
                            </h3>
                            <form
                                action="/create_config"
                                method="post"
                                enctype="multipart/form-data"
                            >
                                <input
                                    type="text"
                                    id="config_name"
                                    name="config_name"
                                    maxlength="50"
                                    placeholder="Configuration name"
                                    class="form-input"
                                />
                                <button
                                    type="submit"
                                    class="btn btn-add full-width"
                                    title="Create a new firewall configuration"
                                >
                                    Create Config
                                </button>
                            </form>

                            {% if file_list %}
                            <h3 class="subsection-title">
                                Delete Configuration
                            </h3>
                            <form action="/delete_config" method="post">
                                <select
                                    id="delete_config"
                                    name="delete_config"
                                    class="form-select"
                                >
                                    <option value="">
                                        Select configuration...
                                    </option>
                                    {% for file in file_list %}
                                    <option value="{{file}}">{{file}}</option>
                                    {% endfor %}
                                </select>
                                <button
                                    type="submit"
                                    class="btn btn-delete full-width"
                                    title="Delete selected configuration"
                                >
                                    Delete Config
                                </button>
                            </form>
                            {% endif %}

                            <h3 class="subsection-title">
                                Import Configuration
                            </h3>
                            <form
                                action="/upload_json"
                                method="post"
                                enctype="multipart/form-data"
                            >
                                <input
                                    type="file"
                                    name="file"
                                    class="form-file"
                                />
                                <button
                                    type="submit"
                                    class="btn btn-secondary full-width"
                                    title="Upload JSON configuration"
                                >
                                    Upload Datafile
                                </button>
                            </form>

                            <h3 class="subsection-title">
                                Export Configuration
                            </h3>
                            <a
                                href="{{url_for('download_json')}}"
                                download="{{firewall_name}}.json"
                                class="btn btn-secondary full-width"
                                title="Download current configuration as JSON"
                                >Download Datafile</a
                            >
                        </div>
                    </div>
                    {% endif %}
                </aside>

                <main class="main-content">
                    {% block body %} {% endblock body %}
                </main>

                <aside class="sidebar-right">
                    {% if firewall_name %}
                    <div class="sidebar-section">
                        <h2 class="section-title">Build Policy</h2>

                        <div class="policy-actions">
                            <h3 class="subsection-title">Interfaces</h3>
                            <a
                                href="{{ url_for('interface_view')}}"
                                class="btn btn-secondary full-width"
                                title="View and edit interfaces"
                                >View Interfaces</a
                            >

                            <h3 class="subsection-title">Groups</h3>
                            <a
                                href="{{ url_for('group_view')}}"
                                class="btn btn-secondary full-width"
                                title="View and edit groups"
                                >View Groups</a
                            >

                            <h3 class="subsection-title">Flowtables</h3>
                            <a
                                href="{{ url_for('flowtable_view')}}"
                                class="btn btn-secondary full-width"
                                title="View and edit flowtables"
                                >View Flowtables</a
                            >

                            <h3 class="subsection-title">Chains</h3>
                            <a
                                href="{{ url_for('chain_view')}}"
                                class="btn btn-secondary full-width"
                                title="View and edit chains and rules"
                                >View Chains</a
                            >

                            <h3 class="subsection-title">Filters</h3>
                            <a
                                href="{{ url_for('filter_view')}}"
                                class="btn btn-secondary full-width"
                                title="View and edit filters and filter rules"
                                >View Filters</a
                            >

                            <h3 class="subsection-title">
                                Extra Configurations
                            </h3>
                            <a
                                href="{{ url_for('configuration_extra_items')}}"
                                class="btn btn-secondary full-width"
                                title="Add extra configurations"
                                >Add Extra Configurations</a
                            >
                        </div>

                        <h2 class="section-title">Deploy Policy</h2>

                        <div class="deploy-actions">
                            <a
                                href="{{ url_for('display_config')}}"
                                class="btn btn-secondary full-width"
                                title="Display generated configuration"
                                >Display Configuration</a
                            >
                            <a
                                href="{{ url_for('configuration_push')}}"
                                class="btn btn-secondary full-width"
                                title="Push configuration to firewall"
                                >Push to Firewall</a
                            >
                            <a
                                href="{{url_for('download_config')}}"
                                download="{{firewall_name}}.cfg"
                                class="btn btn-secondary full-width"
                                title="Download configuration file"
                                >Download Configuration</a
                            >
                        </div>
                    </div>
                    {% endif %}
                </aside>
            </div>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <a
                        href="https://hub.docker.com/repository/docker/ibehren1/fw-gui/general"
                        class="footer-link"
                    >
                        <img
                            src="./static/docker-logo.png"
                            alt="Docker Hub"
                            class="footer-logo"
                        />
                    </a>
                </div>
                <div class="footer-section footer-center">
                    <p class="version">fw-gui {{ config['VERSION'] }}</p>
                    <p class="copyright">
                        Made in the USA<br />
                        <img
                            src="./static/us-flag.png"
                            alt="USA Flag"
                            class="flag-icon"
                        /><br />
                        Copyright © 2023-2026 Isaac Behrens. All rights
                        reserved.
                    </p>
                </div>
                <div class="footer-section">
                    <a
                        href="https://github.com/ibehren1/fw-gui"
                        class="footer-link"
                    >
                        <img
                            src="./static/github-logo.png"
                            alt="GitHub"
                            class="footer-logo"
                        />
                        <img
                            src="./static/github-mark.png"
                            alt="GitHub Mark"
                            class="github-mark"
                        />
                    </a>
                </div>
            </div>
        </footer>
    </body>
</html>
